generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

/* =======================
   USER
======================= */
model User {
  id                        Int      @id @default(autoincrement())
  image                     String?
  firstname                 String
  lastname                  String
  middleInitial             String   @map("middleInitial")
  email                     String   @unique
  designation               String
  department                String
  password                  String
  role                      UserRoles
  status                    Status
  createdAt                 DateTime @default(now()) @map("createdAt")
  updatedAt                 DateTime @updatedAt @map("updatedAt")
  specialization            Json?
  previousSubjects          Json?    @map("previousSubjects")
  yearsOfExperience         Int?     @map("yearsOfExperience")
  preferredTimeSlots        Json?    @map("preferredTimeSlots")
  availableDays             Json?    @map("availableDays")
  facultySubjectAssignments FacultySubjectAssignment[]
  roomSchedules             RoomSchedules[]
  units_loads               Units_Loads[]
  userSubjects              UserSubject[]

  @@map("users")
}

/* =======================
   SUBJECT
======================= */
model Subject {
  id                 Int      @id @default(autoincrement())
  subjectCode        String   @unique @map("subjectCode")
  subjectDescription String   @map("subjectDescription")
  lec                Int      @default(0)
  lab                Int      @default(0)
  units              Int      @default(0)
  prerequisite       Json?
  createdAt          DateTime @default(now()) @map("createdAt")
  updatedAt          DateTime @updatedAt @map("updatedAt")
  tags               Json?
  userSubjects       UserSubject[]

  @@map("subjects")
}

/* =======================
   CURRICULUM COURSES
======================= */
model CurriculumCourse {
  id                 Int      @id @default(autoincrement())
  curriculumYear     String?  @map("curriculumYear")
  programCode        String?  @map("programCode")
  programName        String?  @map("programName")
  lec                Int?
  lab                Int?
  units              Int?
  hours              Int?
  period             String?
  yearLevel          String?  @map("yearLevel")
  createdAt          DateTime @default(now()) @map("createdAt")
  updatedAt          DateTime @updatedAt @map("updatedAt")
  subjectCode        String?  @map("subjectCode")
  subjectDescription String?  @map("subjectDescription")
  courseOfferings    CourseOffering[]

  @@map("curriculum_courses")
}

/* =======================
   COURSE OFFERING
======================= */
model CourseOffering {
  id               Int               @id @default(autoincrement())
  courseType       String?           @map("courseType")
  curriculumId     Int?              @map("curriculumId")
  description      String?
  sectionName      String?           @map("sectionName")
  yearLevel        String            @map("yearLevel")
  createdAt        DateTime          @default(now()) @map("createdAt")
  updatedAt        DateTime          @updatedAt @map("updatedAt")
  curriculumCourse CurriculumCourse? @relation(fields: [curriculumId], references: [id], onDelete: Cascade)
  roomSchedules    RoomSchedules[]

  @@index([curriculumId], map: "course_offerings_curriculumId_idx")
  @@map("course_offerings")
}

/* =======================
   ROOM SCHEDULES
======================= */
model RoomSchedules {
  id             Int             @id @default(autoincrement())
  day            String
  timeStarts     String          @map("timeStarts")
  timeEnds       String          @map("timeEnds")
  room           String?
  offeringId     Int?            @map("offeringId")
  instructorId   Int?            @map("instructorId")
  isLoaded       Int             @map("isLoaded")
  createdAt      DateTime        @default(now()) @map("createdAt")
  updatedAt      DateTime        @updatedAt @map("updatedAt")
  instructor     User?           @relation(fields: [instructorId], references: [id])
  courseOffering CourseOffering? @relation(fields: [offeringId], references: [id], onDelete: Cascade)

  @@index([instructorId], map: "room_schedules_instructorId_idx")
  @@index([offeringId], map: "room_schedules_offeringId_idx")
  @@map("room_schedules")
}

/* =======================
   ACADEMIC PROGRAM
======================= */
model AcademicProgram {
  id          Int      @id @default(autoincrement())
  department  String?
  programCode String?  @map("programCode")
  programName String?  @map("programName")
  createdAt   DateTime @default(now()) @map("createdAt")
  updatedAt   DateTime @updatedAt @map("updatedAt")

  @@map("academic_programs")
}

/* =======================
   OTP
======================= */
model Otp {
  id        Int      @id @default(autoincrement())
  otp       String
  email     String
  createdAt DateTime @default(now()) @map("createdAt")
  expiresAt DateTime @map("expiresAt")

  @@map("otps")
}

/* =======================
   ROOM
======================= */
model Room {
  id        Int      @id @default(autoincrement())
  name      String
  capacity  Int
  createdAt DateTime @default(now()) @map("createdAt")
  updatedAt DateTime @updatedAt @map("updatedAt")

  @@map("rooms")
}

/* =======================
   UNITS LOAD
======================= */
model Units_Loads {
  id           Int      @id @default(autoincrement())
  instructorId Int?     @map("instructorId")
  units        Int
  createdAt    DateTime @default(now()) @map("createdAt")
  updatedAt    DateTime @updatedAt @map("updatedAt")
  instructor   User?    @relation(fields: [instructorId], references: [id])

  @@index([instructorId], map: "units_loads_instructorId_idx")
  @@map("units_loads")
}

/* =======================
   USER-SUBJECT RELATION
======================= */
model UserSubject {
  id        Int      @id @default(autoincrement())
  userId    Int      @map("userId")
  subjectId Int      @map("subjectId")
  createdAt DateTime @default(now()) @map("createdAt")
  updatedAt DateTime @updatedAt @map("updatedAt")
  subject   Subject  @relation(fields: [subjectId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, subjectId])
  @@index([subjectId], map: "user_subjects_subjectId_idx")
  @@map("user_subjects")
}

model notifications {
  id        Int      @id @default(autoincrement())
  content   String
  createdAt DateTime @default(now()) @map("createdAt")
  updatedAt DateTime @updatedAt @map("updatedAt")
}

model TotalUnits {
  id         Int      @id @default(autoincrement())
  totalUnits Int      @default(18) @map("totalUnits")
  createdAt  DateTime @default(now()) @map("createdAt")
  updatedAt  DateTime @updatedAt @map("updatedAt")

  @@map("total_units")
}

/* =======================
   ACADEMIC YEAR
======================= */
model AcademicYear {
  id        Int      @id @default(autoincrement())
  year      String   @unique
  isActive  Boolean  @default(false) @map("isActive")
  createdAt DateTime @default(now()) @map("createdAt")
  updatedAt DateTime @updatedAt @map("updatedAt")

  @@map("academic_years")
}

/* =======================
   FACULTY SUBJECT ASSIGN
======================= */
model FacultySubjectAssignment {
  id                 Int              @id @default(autoincrement())
  facultyId          Int              @map("facultyId")
  subjectCode        String           @map("subjectCode")
  subjectDescription String           @map("subjectDescription")
  units              Int
  dayOfWeek          String           @map("dayOfWeek")
  startTime          String           @map("startTime")
  endTime            String           @map("endTime")
  room               String?
  yearLevel          String?          @map("yearLevel")
  semester           String?
  section            String?
  status             AssignmentStatus @default(DRAFT)
  createdAt          DateTime         @default(now()) @map("createdAt")
  updatedAt          DateTime         @updatedAt @map("updatedAt")
  faculty            User             @relation(fields: [facultyId], references: [id], onDelete: Cascade)

  @@index([facultyId], map: "faculty_subject_assignments_facultyId_idx")
  @@map("faculty_subject_assignments")
}

/* =======================
   SPECIALIZATION
======================= */
model Specialization {
  id          Int      @id @default(autoincrement())
  name        String   @unique
  description String?
  department  String?
  isActive    Boolean  @default(true) @map("isActive")
  createdAt   DateTime @default(now()) @map("createdAt")
  updatedAt   DateTime @updatedAt @map("updatedAt")

  @@map("specializations")
}

/* =======================
   SCHEDULE CONSTRAINT
======================= */
model ScheduleConstraint {
  id              Int            @id @default(autoincrement())
  department      String
  constraintType  ConstraintType @map("constraintType")
  constraintValue String         @map("constraintValue")
  priority        Priority       @default(MEDIUM)
  isActive        Boolean        @default(true) @map("isActive")
  createdAt       DateTime       @default(now()) @map("createdAt")
  updatedAt       DateTime       @updatedAt @map("updatedAt")

  @@map("schedule_constraints")
}

/* =======================
   GENERATION PREFERENCE
======================= */
model GenerationPreference {
  id                  Int              @id @default(autoincrement())
  department          String
  optimizationGoal    OptimizationGoal @default(BALANCED) @map("optimizationGoal")
  maxConsecutiveHours Int              @default(4) @map("maxConsecutiveHours")
  preferredTimeSlots  String?          @map("preferredTimeSlots")
  avoidTimeSlots      String?          @map("avoidTimeSlots")
  roomPreferences     String?          @map("roomPreferences")
  facultyPreferences  String?          @map("facultyPreferences")
  createdAt           DateTime         @default(now()) @map("createdAt")
  updatedAt           DateTime         @updatedAt @map("updatedAt")

  @@map("generation_preferences")
}

/* =======================
   SCHEDULE GENERATION
======================= */
model ScheduleGeneration {
  id               Int                @id @default(autoincrement())
  department       String
  academicYear     String             @map("academicYear")
  semester         String
  yearLevel        String?            @map("yearLevel")
  status           GenerationStatus   @default(PENDING)
  constraintsUsed  String?            @map("constraintsUsed")
  conflictsFound   String?            @map("conflictsFound")
  scheduleData     String?            @map("scheduleData")
  notes            String?
  createdAt        DateTime           @default(now()) @map("createdAt")
  updatedAt        DateTime           @updatedAt @map("updatedAt")
  conflicts        ScheduleConflict[]
  subjectSchedules SubjectSchedule[]

  @@map("schedule_generations")
}

/* =======================
   SUBJECT SCHEDULE
======================= */
model SubjectSchedule {
  id                 Int      @id @default(autoincrement())
  sourceId           String?  @map("sourceId")
  subjectId          String   @map("subjectId")
  subject            String
  subjectCode        String   @map("subjectCode")
  subjectName        String   @map("subjectName")
  subjectDescription String?  @map("subjectDescription")
  faculty            String
  facultyId          String   @map("facultyId")
  facultyName        String   @map("facultyName")
  room               String
  roomId             String   @map("roomId")
  roomName           String   @map("roomName")
  time               String
  day                String
  days               String?
  startTime          String   @map("startTime")
  endTime            String   @map("endTime")
  semester           String   @db.VarChar(32)
  academicYear       String   @map("academicYear") @db.VarChar(16)
  program            String   @db.VarChar(32)
  yearLevel          String   @map("yearLevel") @db.VarChar(32)
  units              Int
  lec                Int      @default(0)
  lab                Int      @default(0)
  students           String?
  totalStudents      Int?     @default(0) @map("totalStudents")
  type               String?  @db.VarChar(32)
  tags               Json?
  recommendedFaculty Json?    @map("recommendedFaculty")
  hasConflict        Boolean? @map("hasConflict")
  status             String?
  conflictType       String?  @map("conflictType")
  department         String?
  curriculumId       Int?     @map("curriculumId")
  instructorId       Int?     @map("instructorId")
  roomLegacyId       Int?     @map("roomLegacyId")
  isActive           Boolean? @default(true) @map("isActive")
  generationId       Int?     @map("generationId")
  generation         ScheduleGeneration? @relation(fields: [generationId], references: [id], onDelete: Cascade)
  createdAt          DateTime @default(now()) @map("createdAt")
  updatedAt          DateTime @updatedAt @map("updatedAt")

  @@index([department, academicYear, semester, yearLevel, program])
  @@map("subject_schedules")
}

/* =======================
   SCHEDULE CONFLICT
======================= */
model ScheduleConflict {
  id            Int           @id @default(autoincrement())
  generationId  Int           @map("generationId")
  conflictType  ConflictType  @map("conflictType")
  description   String
  affectedItems String        @map("affectedItems")
  severity      Severity      @default(MEDIUM)
  isResolved    Boolean       @default(false) @map("isResolved")
  resolution    String?
  createdAt     DateTime      @default(now()) @map("createdAt")
  updatedAt     DateTime      @updatedAt @map("updatedAt")
  generation    ScheduleGeneration @relation(fields: [generationId], references: [id], onDelete: Cascade)

  @@index([generationId], map: "schedule_conflicts_generationId_idx")
  @@map("schedule_conflicts")
}

/* =======================
   PROGRAM PRIORITY
======================= */
model ProgramPriority {
  id          Int      @id @default(autoincrement())
  programCode String   @unique @map("programCode")
  programName String   @map("programName")
  priority    Int
  department  String?
  createdAt   DateTime @default(now()) @map("createdAt")
  updatedAt   DateTime @updatedAt @map("updatedAt")

  @@map("program_priorities")
}

/* ========== ENUMS ========== */

enum UserRoles {
  CAMPUS_ADMIN
  REGISTRAR
  DEPARTMENT_HEAD
  FACULTY
}

enum Status {
  PENDING
  VERIFIED
  APPROVED
}

enum AssignmentStatus {
  DRAFT
  PUBLISHED
}

enum ConstraintType {
  TIME_PREFERENCE
  ROOM_REQUIREMENT
  FACULTY_AVAILABILITY
  SUBJECT_SEQUENCE
  BREAK_DURATION
  MAXIMUM_DAILY_HOURS
  DEPARTMENT_POLICY
}

enum Priority {
  LOW
  MEDIUM
  HIGH
  CRITICAL
}

enum OptimizationGoal {
  MINIMIZE_CONFLICTS
  MAXIMIZE_EFFICIENCY
  BALANCED
  FACULTY_PREFERENCE
  ROOM_UTILIZATION
}

enum GenerationStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  FAILED
  CANCELLED
}

enum ConflictType {
  TIME_OVERLAP
  ROOM_DOUBLE_BOOKING
  FACULTY_OVERLOAD
  CONSTRAINT_VIOLATION
  RESOURCE_UNAVAILABLE
}

enum Severity {
  LOW
  MEDIUM
  HIGH
  CRITICAL
}
